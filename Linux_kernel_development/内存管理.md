## 内存管理

#### 页（page）

![image-20200904144438186](内存管理.assets/image-20200904144438186.png)

![image-20200904144603205](内存管理.assets/image-20200904144603205.png)

![image-20200904144633685](内存管理.assets/image-20200904144633685.png)

![image-20200904144708540](内存管理.assets/image-20200904144708540.png)



#### 区（zone）

![image-20200904144939017](内存管理.assets/image-20200904144939017.png)

![image-20200904145011726](内存管理.assets/image-20200904145011726.png)

![image-20200904145248789](内存管理.assets/image-20200904145248789.png)

![image-20200904145411291](内存管理.assets/image-20200904145411291.png)



#### 获得页

![image-20200904145721367](内存管理.assets/image-20200904145721367.png)

![image-20200904145752994](内存管理.assets/image-20200904145752994.png)

**获得填充为0的页**

![image-20200904150213862](内存管理.assets/image-20200904150213862.png)

**释放页**

![image-20200904150443361](内存管理.assets/image-20200904150443361.png)



#### kmalloc()

![image-20200904150707415](内存管理.assets/image-20200904150707415.png)

![image-20200904150757566](内存管理.assets/image-20200904150757566.png)

**gfp_mask标志**

![image-20200904151222615](内存管理.assets/image-20200904151222615.png)

![image-20200904151304344](内存管理.assets/image-20200904151304344.png)

![image-20200904151355380](内存管理.assets/image-20200904151355380.png)

![image-20200904151445204](内存管理.assets/image-20200904151445204.png)

![image-20200904151513717](内存管理.assets/image-20200904151513717.png)

**kfree()**

![image-20200904151638997](内存管理.assets/image-20200904151638997.png)

![image-20200904151705802](内存管理.assets/image-20200904151705802.png)



#### vmalloc()

![image-20200904151820220](内存管理.assets/image-20200904151820220.png)

![image-20200904160522434](内存管理.assets/image-20200904160522434.png)



#### slab层

![image-20200904161305986](内存管理.assets/image-20200904161305986.png)

**slab层的设计**

![image-20200904172213993](内存管理.assets/image-20200904172213993.png)

![image-20200904164919498](内存管理.assets/image-20200904164919498.png)

![image-20200904172255443](内存管理.assets/image-20200904172255443.png)

**slab分配器的接口**

![image-20200904172644079](内存管理.assets/image-20200904172644079.png)

![image-20200904172720256](内存管理.assets/image-20200904172720256.png)

![image-20200904172751366](内存管理.assets/image-20200904172751366.png)

![image-20200904172831518](内存管理.assets/image-20200904172831518.png)

![image-20200904172857719](内存管理.assets/image-20200904172857719.png)



#### 在栈上的静态分配

![image-20200904173131195](内存管理.assets/image-20200904173131195.png)

**单页内核栈**

![image-20200904183653679](内存管理.assets/image-20200904183653679.png)

**在栈上光明正大地工作**

![image-20200904184307818](内存管理.assets/image-20200904184307818.png)

![image-20200904184339272](内存管理.assets/image-20200904184339272.png)



####  高端内存的映射

![image-20200904184513264](内存管理.assets/image-20200904184513264.png)

**永久映射**

![image-20200904184749006](内存管理.assets/image-20200904184749006.png)

**临时映射**

![image-20200904185230460](内存管理.assets/image-20200904185230460.png)

![image-20200904185254553](内存管理.assets/image-20200904185254553.png)



#### 每个CPU的分配

![image-20200904185545063](内存管理.assets/image-20200904185545063.png)

![image-20200904185612417](内存管理.assets/image-20200904185612417.png)



#### 新的每个CPU接口

![image-20200904185654787](内存管理.assets/image-20200904185654787.png)

**编译时的每个CPU数据**

![image-20200904185742267](内存管理.assets/image-20200904185742267.png)

![image-20200904185840254](内存管理.assets/image-20200904185840254.png)

**运行时的每个CPU数据**

![image-20200904190615720](内存管理.assets/image-20200904190615720.png)

![image-20200904190639872](内存管理.assets/image-20200904190639872.png)



#### 使用每个CPU数据的原因

![image-20200904190734367](内存管理.assets/image-20200904190734367.png)



#### 分配函数的选择

![image-20200904191023947](内存管理.assets/image-20200904191023947.png)



